let responseData = [{
    "tagID":"303400009400404001312D22",
    "catalog":"6276-7-314",
    "lot":"CAXT11PE",
    "expiryDate":"2020-09-21",
    "description": "REST MOD CONICAL DISTAL BOWED STEM 14mmX235mm",
    "owner":"NLE",
    "commission":"",
    "status": 1
},{
    "tagID":"303400009400408001312D24",
    "catalog":"6276-7-315",
    "lot":"CAXT21JD",
    "expiryDate":"2020-09-05",
    "description": "REST MOD CONICAL DISTAL BOWED STEM 15mmX235mm",
    "owner":"NLE",
    "commission":"",
    "status": 2
},{
    "tagID":"3034000094003DC001312D35",
    "catalog":"6276-7-316",
    "lot":"CAXW629H",
    "expiryDate":"2023-01-16",
    "description": "REST MOD CONICAL DISTAL BOWED STEM 16mmX235mm",
    "owner":"NLE",
    "commission":"",
    "status": 3
},{
    "tagID":"3034000094003D0001312D2F",
    "catalog":"6276-7-317",
    "lot":"CAXV60TE",
    "expiryDate":"2022-02-23",
    "description": "REST MOD CONICAL DISTAL BOWED STEM 17mmX235mm",
    "owner":"NLE",
    "commission":"",
    "status": 4
},{
    "tagID":"3034000094003E0001312D29",
    "catalog":"6276-7-318",
    "lot":"CAXT305D",
    "expiryDate":"2020-07-12",
    "description": "REST MOD CONICAL DISTAL BOWED STEM 18mmX235mm",
    "owner":"NLE",
    "commission":"",
    "status": 5
},{
    "tagID":"303400009400400001312D3A",
    "catalog":"6276-7-319",
    "lot":"CAXW727F",
    "expiryDate":"2023-03-19",
    "description": "REST MOD CONICAL DISTAL BOWED STEM 19mmX235mm",
    "owner":"NLE",
    "commission":"",
    "status": 6
},{
    "tagID":"3034000094003FC001312D36",
    "catalog":"6276-7-320",
    "lot":"CAXW42XF",
    "expiryDate":"2022-10-19",
    "description": "REST MOD CONICAL DISTAL BOWED STEM 20mmX235mm",
    "owner":"NLE",
    "commission":"",
    "status": 7
},{
    "tagID":"3034000094003F8001312D39",
    "catalog":"6276-7-321",
    "lot":"CAXW62KE",
    "expiryDate":"2023-05-02",
    "owner":"NLE",
    "description": "REST MOD CONICAL DISTAL BOWED STEM 21mmX235mm",
    "commission":"",
    "status": 8
},{
    "tagID":"3034000094003F4001312D38",
    "catalog":"6276-7-322",
    "lot":"CAXW72AC",
    "expiryDate":"2023-02-04",
    "description": "REST MOD CONICAL DISTAL BOWED STEM 22mmX235mm",
    "owner":"NLE",
    "commission":"",
    "status": 9
},{
    "tagID":"3034000094003F0001312D3A",
    "catalog":"6276-7-323",
    "lot":"CAXW431E",
    "expiryDate":"2023-01-11",
    "description": "REST MOD CONICAL DISTAL BOWED STEM 23mmX235mm",
    "owner":"NLE",
    "commission":"",
    "status": 10
},{
    "tagID":"3034000094003EC001312D38",
    "catalog":"6276-7-324",
    "lot":"CAXW72EA",
    "expiryDate":"2023-02-06",
    "description":"REST MOD CONICAL DISTAL BOWED STEM 24mmX235mm",
    "owner":"NLE",
    "commission":"",
    "status": 11
},{
    "tagID":"3034000094003D8001312D33",
    "catalog":"6276-7-325",
    "lot":"CAXW80MC",
    "expiryDate":"2023-08-12",
    "description": "REST MOD CONICAL DISTAL BOWED STEM 25mmX235mm",
    "owner":"NLE",
    "commission":"",
    "status": 12
},{
    "tagID":"3034000094003D4001312D38",
    "catalog":"6276-7-326",
    "lot":"CAXW80NA",
    "expiryDate":"2023-07-16",
    "description": "REST MOD CONICAL DISTAL BOWED STEM 26mmX235mm",
    "owner":"NLE",
    "commission":"",
    "status": 13
},{
    "tagID":"3034000094003E4001312D3C",
    "catalog":"6276-7-327",
    "lot":"CAXW433A",
    "expiryDate":"2022-12-16",
    "description": "REST MOD CONICAL DISTAL BOWED STEM 27mmX235mm",
    "owner":"NLE",
    "commission":"",
    "status": 14
},{
    "tagID":"3034000094003E8001312D3B",
    "catalog":"6276-7-328",
    "lot":"CAXW80RA",
    "expiryDate":"2023-07-21",
    "description": "REST MOD CONICAL DISTAL BOWED STEM 28mmX235mm",
    "owner":"NLE",
    "commission":"",
    "status": 15
}];

let backOrderData = [{
    "checked": '1',
    "catalog":"6276-7-314",
    "lot":"CAXT11PE"
},{
    "checked": '1',
    "catalog":"6276-7-315",
    "lot":"CAXT21JD"
},{
    "checked": '1',
    "catalog":"6276-7-316",
    "lot":"CAXW629H"
},{
    "checked": null,
    "catalog":"6276-7-317",
    "lot":"CAXV60TE"
},{
    "checked": null,
    "catalog":"6276-7-318",
    "lot":"CAXT305D"
},{
    "checked": null,
    "catalog":"6276-7-319",
    "lot":"CAXW727F"
},{
    "checked": null,
    "catalog":"6276-7-320",
    "lot":"CAXW42XF"
},{
    "checked": null,
    "catalog":"6276-7-321",
    "lot":"CAXW62KE"
},{
    "checked": null,
    "catalog":"6276-7-322",
    "lot":"CAXW72AC"
},{
    "checked": null,
    "catalog":"6276-7-323",
    "lot":"CAXW431E"
},{
    "checked": null,
    "catalog":"6276-7-324",
    "lot":"CAXW72EA"
},{
    "checked": null,
    "catalog":"6276-7-325",
    "lot":"CAXW80MC"
},{
    "checked": null,
    "catalog":"6276-7-326",
    "lot":"CAXW80NA"
},{
    "checked": null,
    "catalog":"6276-7-327",
    "lot":"CAXW433A"
},{
    "checked": null,
    "catalog":"6276-7-328",
    "lot":"CAXW80RA"
}];
$(document).ready(function() {
    /* Setup - add a text input to each footer cell */
    $('#buildKitGrid thead tr').clone(true).appendTo( '#buildKitGrid thead' );
    $('#buildKitGrid thead tr:eq(1) th').each( function (i) {
        let title = $(this).text();        
        let width = '90%';
        if(title==='Commission'){
            $(this).html( '<label></label>');
        } else {
            $(this).html( '<input class="w3-input w3-border w3-round w3-tiny" style="width:'+ width +'" type="text" placeholder="Search..." />' );
    
            $('input', this).on( 'keyup change', function () {
                if ( table.column(i).search() !== this.value ) {
                    table
                        .column(i)
                        .search( this.value )
                        .draw();
                }
            });
        }
    });
    /* End Setup - add a text input to each footer cell */

    let table = $('#buildKitGrid').DataTable({
        // ajax: {
        //     url: '../data/grid-data.json',
        //     dataSrc: "responseData"
        // },
        data: responseData,
        columns: [
            { data: 'tagID'},
            { data: 'catalog'},
            { data: 'lot'},
            { data: 'expiryDate'},
            { data: 'owner'},
            { data: 'commission',
                orderable: false,
                "render": function ( data, type, row ) {
                    if (row.catalog==='6276-7-314' || row.catalog==='6276-7-315' || row.catalog==='6276-7-316') {
                        return '<div style="cursor:pointer; font-size:20px;"><i class="fa fa-qrcode" aria-hidden="true"></i></div>';
                    } else {
                        return data;
                    }
                }
            },
            {
                data: 'status',
                visible: false
            }
        ],
        deferRender: true,
        scrollY: 300,
        scrollX: true,
        scrollCollapse: true,
        scroller: true,
        orderClasses: false,
        order: [[6, 'asc']],

        orderCellsTop: true,
        bInfo: false,
        bPaginate: false,
        dom: 'lrtp',
        bSort: true,
        createdRow: function(row, data, dataIndex) {
            if (data.catalog==='6276-7-314' || data.catalog==='6276-7-315' || data.catalog==='6276-7-316' ) {
                $(row).addClass('orange');
            }
        }
    });
    table.on('click', 'tbody td', function() {
        //get textContent of the TD
        // console.log('TD cell textContent : ', this.textContent)
        //get the value of the TD using the API 
        // console.log('value by API : ', table.cell({ row: this.parentNode.rowIndex, column : this.cellIndex }).data());
        // console.log(table.cell(this).data());
        if(this.cellIndex==5) {
            let row_clicked     = $(this).closest('tr');
            let row_object      = table.row(row_clicked).data();
            // debugger
            // if($('#buildKitGrid tr td').eq($(this).index()).html().indexOf('fa-qrcode')!=-1){
                alert('Catelog: ' + row_object.catalog + ' Lot: ' + row_object.lot);
            // }
            //commision present or not 
            //$('#buildKitGrid thead tr th').eq($(this).index()).html().indexOf('Commission')
        }
    });
    /* Setup - add a text input to each footer cell */
    $('#backOrderGrid thead tr').clone(true).appendTo( '#backOrderGrid thead' );
    $('#backOrderGrid thead tr:eq(1) th').each( function (i) {
        let title = $(this).text();
        if(title!="" && title!=null && title!='1'){
            $(this).html( '<input class="w3-input w3-border w3-round w3-tiny" style="width:90%" type="text" placeholder="Search..." />' );
            // $(this).html( '<input style="width:75px" type="text" placeholder="Search '+title+'" />' );
    
            $('input', this).on( 'keyup change', function () {
                if ( backOrderGridTable.column(i).search() !== this.value ) {
                    backOrderGridTable
                        .column(i)
                        .search( this.value )
                        .draw();
                }
            });
        }
    });
    /* End Setup - add a text input to each footer cell */
    let backOrderGridTable = $('#backOrderGrid').DataTable({
        'initComplete': function(settings){
            let api = this.api();
            api.cells(
               api.rows(function(idx, data, node){
                  return (data.checked === '1') ? true : false;
               }).indexes(),
               0
            ).checkboxes.select();
        },
        columnDefs: [ {
            orderable: false,
            // className: 'select-checkbox',
            checkboxes: {
                'selectRow': true
            },
            targets:   0
        }],
        select: {
            //style:    'os',
            style: 'multi',
            selector: 'td:first-child'
        },
        order: [[ 1, 'asc' ]],
        data: backOrderData,
        columns: [
            { data: 'checked', width: '10px'},
            { data: 'catalog' },
            { data: 'lot'}
        ],
        deferRender: true,
        scrollY: 300,
        scrollX: true,
        scrollCollapse: true,
        scroller: true,

        orderCellsTop: true,
        //fixedHeader: true,
        bInfo: false,
        bPaginate: false,
        dom: 'lrtp',
        bSort: true
    });
    $('#kitRefreshBtn').click(function(){
        let table = $('#buildKitGrid').DataTable();
        let availableItemtable = $('#backOrderGrid').DataTable();
        table.order( [ 6, 'asc' ] ).draw();
        availableItemtable.order( [ 1, 'asc' ] ).draw();
    });
});